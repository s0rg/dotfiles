###########################################################
#
#   ██╗ ██████╗  ██╗    ██╗ ███╗   ███╗
#   ██║ ╚════██╗ ██║    ██║ ████╗ ████║
#   ██║  █████╔╝ ██║ █╗ ██║ ██╔████╔██║
#   ██║  ╚═══██╗ ██║███╗██║ ██║╚██╔╝██║
#   ██║ ██████╔╝ ╚███╔███╔╝ ██║ ╚═╝ ██║
#   ╚═╝ ╚═════╝   ╚══╝╚══╝  ╚═╝     ╚═╝
#
# i3 config file (v4)
#
# Complete reference: http://i3wm.org/docs/userguide.html

# win key
set $mod            Mod4
set $alt            Mod1
set $ctrl           Control

set $term           kitty
set $vol_step       5%
set $vol_sink       @DEFAULT_SINK@
set $bri_step       10

set $run            exec --no-startup-id
set $mode_reset     mode "default"
set $float          floating enable
set $center         move position 10 ppt 10 ppt; resize set 80 ppt 80 ppt
set $move_pad       move scratchpad
set $show_pad       scratchpad show

floating_modifier       $mod
workspace_layout        tabbed

default_border          pixel 1
default_floating_border pixel 1
default_orientation     horizontal

hide_edge_borders       smart

show_marks              no
focus_follows_mouse     no
mouse_warping           none
focus_wrapping          workspace

workspace_auto_back_and_forth no

floating_minimum_size 150 x 100
floating_maximum_size -10 x -10

## KEYS

set $rofi rofi [r]un [w]in [f]ox [q]uit
mode "$rofi" {
    bindsym r $run "rofi -show combi -display-combi 'run '",              $mode_reset
    bindsym w $run "rofi -show window -display-window 'win '",            $mode_reset
    bindsym f $run "rofi -show rfox -modi rfox:~/.local/scripts/rofifox", $mode_reset
    bindsym q $run "rofi -show roff -modi roff:~/.local/scripts/rofioff", $mode_reset

    bindsym Escape $mode_reset
}

set $window window [k]ill [x]kill [f]ull f[l]oat [s]ticky [m]ode
mode "$window" {
    bindsym k kill,              $mode_reset
    bindsym x $run xkill,        $mode_reset
    bindsym s sticky toggle,     $mode_reset
    bindsym l floating toggle,   $mode_reset
    bindsym f fullscreen toggle, $mode_reset
    bindsym m focus mode_toggle, $mode_reset

    bindsym Escape $mode_reset
}

set $toggle toggle [t]ouchpad [m]ic [r]edshift [d]unst [n]otifies
mode "$toggle" {
    bindsym t $run touchpad_toggle,            $mode_reset
    bindsym m $run pulse_mic --toggle,         $mode_reset
    bindsym r $run pkill -USR1 redshift,       $mode_reset
    bindsym n $run dunstctl close-all,         $mode_reset
    bindsym d $run dunstctl set-paused toggle, $mode_reset

    bindsym Escape $mode_reset
}

set $split split [t]oggle [v]ertical [h]orizontal
mode "$split" {
    bindsym t layout toggle split splitv splith, $mode_reset
    bindsym h split h,                           $mode_reset
    bindsym v split v,                           $mode_reset

    bindsym Escape $mode_reset
}

set $resize window resize
mode "$resize" {
    bindsym Up    resize shrink height 5 px or 5 ppt
    bindsym Down  resize grow   height 5 px or 5 ppt
    bindsym Left  resize shrink width  5 px or 5 ppt
    bindsym Right resize grow   width  5 px or 5 ppt

    bindsym Escape $mode_reset
}

bindsym $mod+Return     exec $term, focus
bindsym $mod+c          $run i3-cmus
bindsym $mod+Tab        layout toggle all

# window navigation
bindsym $mod+Up         focus up
bindsym $mod+Down       focus down
bindsym $mod+Left       focus left
bindsym $mod+Right      focus right

# modes
bindsym $mod+r          mode "$rofi"
bindsym $mod+w          mode "$window"
bindsym $mod+t          mode "$toggle"
bindsym $mod+s          mode "$split"
#bindsym $mod+e          mode "$resize"

# config reload
bindsym $mod+$ctrl+c    reload
# restart in-place
bindsym $mod+$ctrl+r    restart

# media keys
## volume
bindsym XF86AudioRaiseVolume  $run pactl set-sink-volume $vol_sink +$vol_step
bindsym XF86AudioLowerVolume  $run pactl set-sink-volume $vol_sink -$vol_step
bindsym XF86AudioMute         $run pactl set-sink-mute $vol_sink toggle

## cmus
bindsym XF86AudioPlay         $run cmus-remote --pause
bindsym XF86AudioNext         $run cmus-remote --next
bindsym XF86AudioPrev         $run cmus-remote --prev

## backlight
bindsym XF86MonBrightnessUp   $run xbacklight -inc $bri_step
bindsym XF86MonBrightnessDown $run xbacklight -dec $bri_step

bindsym --release Print       $run i3-scrot --desk
bindsym --release $ctrl+Print $run i3-scrot --window

# scratchpad
## move window
bindsym $mod+KP_Subtract      $move_pad
## show last window
bindsym $mod+KP_Add           $show_pad

## WINDOW RULES

# auto focus
for_window [urgent=latest]                     focus
for_window [class="^kitty$"]                   focus

# auto floaters
for_window [window_role="pop-up"]              $float
for_window [window_role="bubble"]              $float
for_window [window_role="task_dialog"]         $float
for_window [window_role="Preferences"]         $float
for_window [window_type="dialog"]              $float
for_window [window_type="menu"]                $float
for_window [window_type="notification"]        $float
for_window [window_type="toolbar"]             $float
for_window [window_type="splash"]              $float
for_window [window_type="utility"]             $float
for_window [window_type="dropdown_menu"]       $float
for_window [window_type="popup_menu"]          $float
for_window [window_type="tooltip"]             $float
for_window [window_type="dock"]                $float

# scratchpad
for_window [class="^kitty$" instance="^cmus$"] mark pad
for_window [con_mark="pad"]                    $float, $center, $move_pad

# custom rules
for_window [class="^pavucontrol-qt$"]          $float
for_window [class="^zoom$"]                    $float

for_window [class="^Firefox$" title="^Picture-in-Picture$"] $float, sticky enable

## WORKSPACES

set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
#set $ws6 "6"

# switch to workspace
bindsym $mod+1 workspace number $ws1
bindsym $mod+2 workspace number $ws2
bindsym $mod+3 workspace number $ws3
bindsym $mod+4 workspace number $ws4
bindsym $mod+5 workspace number $ws5
#bindsym $mod+6 workspace number $ws6

# move focused container to workspace
bindsym $mod+$ctrl+1 move container to workspace number $ws1
bindsym $mod+$ctrl+2 move container to workspace number $ws2
bindsym $mod+$ctrl+3 move container to workspace number $ws3
bindsym $mod+$ctrl+4 move container to workspace number $ws4
bindsym $mod+$ctrl+5 move container to workspace number $ws5
#bindsym $mod+Shift+6 move container to workspace number $ws6

# terminal
assign [class="^kitty$" instance="^kitty$"]  $ws1

# web
assign [class="^Firefox$"]                   $ws2
assign [class="^Tor Browser$"]               $ws2
assign [class="^qbittorrent$"]               $ws2

# chat
assign [class="^TelegramDesktop$"]           $ws3

# apps
assign [class="^pcmanfm-qt$"]                $ws4
assign [class="^FeatherPad$"]                $ws4
assign [class="^qimgv$"]                     $ws4
assign [title="^Steam"]                      $ws4

# zoom
assign [class="^zoom$"]                      $ws5

## UI

# remove all decorations
font                          pango:monospace 0px
set_from_resource             $bg i3wm.color0 #000000
set_from_resource             $fg i3wm.color2 #00FF00
set_from_resource             $ag i3wm.color4 #0000FF

# <colorclass>               <border> <background> <text> <indicator> <child_border>
client.focused                $ag      $bg          $bg    $bg         $fg
client.focused_inactive       $fg      $bg          $bg    $bg         $bg
client.unfocused              $fg      $bg          $bg    $bg         $bg
client.placeholder            $fg      $bg          $bg    $bg         $bg
client.urgent                 $fg      $bg          $bg    $bg
client.background             $bg

## AUTOSTART

exec --no-startup-id systemctl --user import-environment DISPLAY
exec --no-startup-id xss-lock --transfer-sleep-lock -- i3lock-fancy

exec --no-startup-id /usr/libexec/geoclue-2.0/demos/agent

exec --no-startup-id setxkbmap -model pc105 -layout us,ru -option terminate:ctrl_alt_bksp,grp:ctrl_shift_toggle
exec --no-startup-id xset m 20/10 10 r rate 350 30 b on s 600

exec --no-startup-id wal -R -n
exec --no-startup-id feh --no-fehbg --bg-fill ~/.config/i3/wall.png

exec --no-startup-id nm-applet
exec --no-startup-id kbdd
exec --no-startup-id udiskie

# bar
exec_always --no-startup-id $HOME/.config/polybar/launch.sh
# cmus for scratchpad
#exec_always --no-startup-id i3-cmus

# first terminal
exec --no-startup-id $term

# vim:ft=i3config
